<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Gu√≠a mapa Carboneras & N√≠jar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
  <style>
    :root {
      --bg: #0b1020;
      --panel: rgba(18, 24, 38, 0.75);
      --text: #e8edf2;
      --muted: #a9b3c1;
      --accent: #58c4d7;
      --accent-2: #81e6d9;
      --card: #ffffff;
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
      --radius: 10px;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #map {
      position: absolute;
      inset: 0;
    }

    /* Panel superior de controles */
    .control-bar {
      position: absolute;
      top: 12px;
      left: 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      background: var(--panel);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      z-index: 2;
    }

    .control-bar label {
      font-size: 14px;
      color: var(--muted);
      letter-spacing: 0.2px;
    }

    #language-selector {
      appearance: none;
      padding: 8px 12px;
      font-size: 15px;
      color: #0f172a;
      border-radius: 8px;
      border: 1px solid #d0d8e3;
      background: linear-gradient(#fff, #f7fafc);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6), 0 1px 2px rgba(0, 0, 0, 0.05);
      cursor: pointer;
    }

    /* Estilo de marcador */
    .marker {
    width: 56px;
    height: 56px;
    background-size: cover;
    background-position: center;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    transition: transform 80ms ease; /* antes 140ms */
    cursor: pointer;
  }
  .marker:hover,
  .marker:focus {
    transform: scale(1.02); /* menos rebote */
    outline: none;
  }

    /* Popups */
    .mapboxgl-popup {
      max-width: 360px;
    }

    .mapboxgl-popup-content {
      padding: 12px 12px 10px 12px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .popup-title {
      margin: 0 0 8px 0;
      font-size: 18px;
      color: #0f172a;
      letter-spacing: 0.2px;
    }

    .popup-media {
      width: 100%;
      margin-bottom: 8px;
      border-radius: 8px;
      overflow: hidden;
      background: #f2f5f8;
      border: 1px solid #eef2f7;
    }

    .popup-description {
      max-height: 180px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-right: 6px;
      font-size: 14px;
      line-height: 1.45;
      color: #1f2937;
    }

    .popup-description::-webkit-scrollbar {
      width: 8px;
    }

    .popup-description::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.18);
      border-radius: 4px;
    }

    .popup-description a {
      color: #0b7ddc;
      text-decoration: underline;
      font-weight: 600;
    }

    .popup-description a:hover {
      color: #0a66b2;
    }

    audio, video {
      width: 100%;
    border: none;
    border-top: 2px solid #60c1df; /* l√≠nea continua clara */
    padding-top: 4px;
    margin-top: 8px;
    border-radius: 0;
    background: transparent;
    }

    /* Toast (mensajes sutiles) */
    .toast {
      position: absolute;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--panel);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(8px);
      box-shadow: var(--shadow);
      font-size: 14px;
      display: none;
      z-index: 2;
    }

    @media (max-width: 600px) {
      .control-bar {
        right: 12px;
      }
      .mapboxgl-popup {
        max-width: 92vw;
      }
    }
  </style>
</head>
<body>
  <div class="control-bar" role="region" aria-label="Controles del mapa">
    <label for="language-selector">Idioma</label>
    <select id="language-selector" aria-label="Selecciona idioma">
      <option value="es" selected>üá™üá∏ Espa√±ol</option>
      <option value="en">üá¨üáß English</option>
      <option value="fr">üá´üá∑ Fran√ßais</option>
    </select>
  </div>

  <div id="map" aria-label="Mapa interactivo de Carboneras y N√≠jar"></div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibmVwdGVjaG5vbG9neSIsImEiOiJjbWRkZW1sNzQwM2JqMm1xdzUyZWsyNXBzIn0.NqcQR3KhSFBlAKR_nvQsqw';

    // L√≠mites navegables aproximados del √°rea
    const bounds = [
      [-1.994104, 36.897126], // SO
      [-1.876345, 36.998783]  // NE
    ];

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/standard-satellite',
      center: [-1.897802, 36.990419],
      zoom: 14.8,
      pitch: 64,
      bearing: 288,
      maxBounds: bounds
    });


    function scaleMarkers() {
    const zoom = map.getZoom();
    const baseSize = 56; // tama√±o base en px
    const scale = Math.max(0.5, Math.min(1.2, zoom / 15)); 
    document.querySelectorAll('.marker').forEach(m => {
      m.style.width = baseSize * scale + 'px';
      m.style.height = baseSize * scale + 'px';
    });
  }

  map.on('zoom', scaleMarkers);
  map.on('load', () => {
    scaleMarkers();
  });

    // Controles de mapa
    map.addControl(new mapboxgl.NavigationControl({ visualizePitch: true }), 'top-right');
    map.addControl(new mapboxgl.FullscreenControl(), 'top-right');
    map.addControl(new mapboxgl.ScaleControl({ unit: 'metric' }), 'bottom-right');
    map.addControl(new mapboxgl.GeolocateControl({
      positionOptions: { enableHighAccuracy: true },
      trackUserLocation: true,
      showUserHeading: true
    }), 'top-right');

    // Toast
    function showToast(message, duration = 3500) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.display = 'block';
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => (toast.style.display = 'none'), duration);
    }

    // Marcador de usuario (geolocalizaci√≥n continua)
    let userMarker;
    if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          const userCoords = [longitude, latitude];

          if (userMarker) {
            userMarker.setLngLat(userCoords);
          } else {
            userMarker = new mapboxgl.Marker({ color: '#2563eb' })
              .setLngLat(userCoords)
              .setPopup(new mapboxgl.Popup({ offset: 20 }).setText('Tu ubicaci√≥n'))
              .addTo(map);

            map.flyTo({ center: userCoords, zoom: 15, speed: 0.6 });
          }
        },
        (error) => {
          console.error('Error de geolocalizaci√≥n:', error);
          showToast('No se pudo obtener tu ubicaci√≥n. Revisa los permisos del navegador.');
        },
        { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
      );
    }

    // Datos
    const Puntos = [
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/salida.png',
        videoUrl: '',
        lnglat: [-1.897802, 36.990419],
        nombre: {
          es: 'Salida: Puerto de Carboneras',
          en: 'Start: Port of Carboneras',
          fr: 'D√©part : Port de Carboneras'
        },
        description: {
          es: `Inaugurado en 1991 por los Reyes de Espa√±a, el puerto pesquero de Carboneras es uno de los m√°s activos de la costa mediterr√°nea. Aqu√≠ puedes vivir de cerca la estampa marinera: barcos palangreros, de arrastre y de cerco; redes tendidas al sol; y casetas de pescadores que conservan el encanto tradicional. La flota palangrera de Carboneras, especializada en at√∫n rojo y pez espada, es de las m√°s destacadas del Mediterr√°neo. En el puerto se encuentra la lonja, que acoge cada tarde la subasta de pescado reci√©n capturado, despu√©s presente en los restaurantes del municipio. No te vayas sin probar la gamba roja de Carboneras, capturada en aguas profundas frente a su costa: un emblema de la gastronom√≠a local por su sabor intenso y textura jugosa. Tambi√©n son t√≠picos los <a href="https://www.fishipedia.es/pez/xyrichtys-novacula" target="_blank" rel="noopener noreferrer">galanes</a>, de carne blanca y delicada, y los <a href="https://www.fishipedia.es/pez/bothus-podas" target="_blank" rel="noopener noreferrer">tapaculos</a>, muy comunes en estas aguas.`,
          en: `Opened in 1991 by the King and Queen of Spain, the fishing port of Carboneras is among the most active on the Mediterranean coast. Here you can soak up maritime life up close: longliners, trawlers and purse seiners; nets drying in the sun; and fishermen‚Äôs huts that still retain their traditional charm. Carboneras‚Äô longline fleet, specializing in bluefin tuna and swordfish, is one of the most prominent in the Mediterranean. The fish market hosts a daily afternoon auction of freshly landed catch, later featured across town restaurants. Don‚Äôt leave without tasting Carboneras‚Äô red prawn, caught in deep local waters‚Äîcelebrated for its intense flavor and succulent texture. Also typical are the <a href="https://www.fishipedia.es/pez/xyrichtys-novacula" target="_blank" rel="noopener noreferrer">galanes (pearlsides wrasse)</a> and the <a href="https://www.fishipedia.es/pez/bothus-podas" target="_blank" rel="noopener noreferrer">tapaculos (wide-eyed flounder)</a>, both common here.`,
          fr: `Inaugur√© en 1991 par les Rois d‚ÄôEspagne, le port de p√™che de Carboneras compte parmi les plus actifs de la c√¥te m√©diterran√©enne. On y d√©couvre la vie maritime de pr√®s‚ÄØ: palangriers, chalutiers et senneurs‚ÄØ; filets s√©chant au soleil‚ÄØ; cabanes de p√™cheurs au charme intact. La flotte palangri√®re, sp√©cialis√©e dans le thon rouge et l‚Äôespadon, est l‚Äôune des plus notables de M√©diterran√©e. La cri√©e organise chaque apr√®s-midi la vente aux ench√®res de poissons fra√Æchement d√©barqu√©s, que l‚Äôon retrouve ensuite sur les tables des restaurants. Ne partez pas sans go√ªter √† la crevette rouge de Carboneras, p√™ch√©e en eaux profondes‚ÄØ: un embl√®me local pour sa saveur intense et sa texture juteuse. Sont aussi typiques les <a href="https://www.fishipedia.es/pez/xyrichtys-novacula" target="_blank" rel="noopener noreferrer">galanes</a> et les <a href="https://www.fishipedia.es/pez/bothus-podas" target="_blank" rel="noopener noreferrer">tapaculos</a>, tr√®s pr√©sents dans ces eaux.`
        },
        audioUrl: { es: 'audio/salida-es.mp3', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/isla.png',
        videoUrl: 'video/isla.mp4',
        lnglat: [-1.885625, 36.992776],
        nombre: {
          es: 'Isla de San Andr√©s',
          en: 'San Andr√©s Island',
          fr: '√éle de San Andr√©s'
        },
        description: {
          es: `A solo 400 metros de la costa de Carboneras se alza la Isla de San Andr√©s, una formaci√≥n volc√°nica de unos 15.000 m<sup>2</sup> declarada Monumento Natural por su gran valor ecol√≥gico. Es uno de los lugares m√°s emblem√°ticos del municipio y un faro para los amantes del mar. Bajo sus aguas se esconde un para√≠so submarino: fondos rocosos con grietas, cuevas y praderas marinas donde observar meros, serranos, casta√±uelas, doncellas, tordos verdes, sargos, mojarras, obladas, espetones e incluso corvinas y peces luna en primavera. Puedes contratar rutas en kayak para rodearla sin desembarcar o bucear en sus fondos rocosos para contemplar de cerca su vida marina.`,
          en: `Just 400 meters off the Carboneras coastline rises San Andr√©s Island, a volcanic formation of around 15,000 m<sup>2</sup> declared a Natural Monument for its ecological significance. It‚Äôs an emblematic spot and a beacon for sea lovers. Beneath the surface lies an underwater paradise: rocky beds with fissures, caves and seagrass meadows hosting groupers, combers, damselfish, wrasses, green wrasse, black and white seabream, two-banded seabream, barracudas, and even croakers and ocean sunfish in spring. Book a kayak tour to circle the island without landing, or dive the rocky bottoms to get closer to its marine life.`,
          fr: `√Ä seulement 400 m√®tres du littoral de Carboneras se dresse l‚Äô√Æle de San Andr√©s, formation volcanique d‚Äôenviron 15‚ÄØ000 m<sup>2</sup> class√©e Monument naturel pour sa grande valeur √©cologique. Lieu embl√©matique et rep√®re des amoureux de la mer, elle abrite un v√©ritable paradis sous-marin‚ÄØ: fonds rocheux, fissures, grottes et prairies marines o√π observer m√©rous, serrans, castagnoles, demoiselles, girelles, sars, bogues, oblades, barracudas et, au printemps, corvinas et poissons-lunes. Des sorties en kayak permettent d‚Äôen faire le tour, ou bien on peut plonger pour admirer de plus pr√®s sa vie marine.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/castillo.png',
        videoUrl: '',
        lnglat: [-1.894318, 36.996523],
        nombre: {
          es: 'Castillo de San Andr√©s',
          en: 'San Andr√©s Castle',
          fr: 'Ch√¢teau de San Andr√©s'
        },
        description: {
          es: `Construido entre finales del siglo XVI y 1621 por orden de Luis L√≥pez de Haro, marqu√©s de Carpio, con permiso de Felipe II, este castillo vigilaba la costa frente a ataques piratas. Su s√≥lida f√°brica de mamposter√≠a luce tres torres cil√≠ndricas y una gran torre en el √°ngulo sur, coronada por matac√°n defensivo y el escudo de los Carpio sobre la entrada. Marc√≥ el origen del n√∫cleo urbano de Carboneras: se repartieron tierras a los soldados para favorecer su asentamiento. En su interior hubo viviendas, almacenes, caballerizas y una capilla dedicada a San Andr√©s. Declarado Bien de Inter√©s Cultural (BIC) en 1993, ha sido restaurado y hoy acoge actividades culturales y la oficina de turismo.`,
          en: `Built between the late 16th century and 1621 by order of Luis L√≥pez de Haro, Marquis of Carpio, with permission from Philip II, this castle guarded the coast from pirate raids. Its sturdy masonry features three cylindrical towers and a larger southern tower crowned with a defensive machicolation and the Carpio coat of arms above the main gate. It marked the birth of Carboneras‚Äô urban core: land was granted to soldiers to encourage settlement. Inside stood homes, stores, stables and a chapel dedicated to Saint Andrew. Declared a Site of Cultural Interest (BIC) in 1993, it has been restored and now hosts cultural events and the tourist office.`,
          fr: `√âdifi√© entre la fin du XVI·µâ si√®cle et 1621 sur ordre de Luis L√≥pez de Haro, marquis de Carpio, avec l‚Äôautorisation de Philippe II, ce ch√¢teau surveillait la c√¥te contre les attaques de pirates. Sa solide ma√ßonnerie pr√©sente trois tours cylindriques et une grande tour au sud, couronn√©e d‚Äôun m√¢chicoulis d√©fensif, avec le blason des Carpio au-dessus de l‚Äôentr√©e. Il a marqu√© la naissance du noyau urbain de Carboneras‚ÄØ: des terres furent attribu√©es aux soldats pour favoriser leur installation. Il abritait des logements, des magasins, des √©curies et une chapelle d√©di√©e √† Saint Andr√©. Class√© Bien d‚Äôint√©r√™t culturel (BIC) en 1993, il a √©t√© restaur√©‚ÄØ; il accueille aujourd‚Äôhui des activit√©s culturelles et l‚Äôoffice de tourisme.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/faro.png',
        videoUrl: '',
        lnglat: [-1.906756, 36.94169],
        nombre: {
          es: 'Faro de Mesa Rold√°n',
          en: 'Mesa Rold√°n Lighthouse',
          fr: 'Phare de Mesa Rold√°n'
        },
        description: {
          es: `Situado a 220 m sobre el nivel del mar, en lo alto de una antigua formaci√≥n volc√°nica, el Faro de Mesa Rold√°n regala una de las vistas m√°s impresionantes del Parque Natural Cabo de Gata‚ÄëN√≠jar. A solo 7 km de Carboneras y 4 km de Agua Amarga, se inaugur√≥ en 1863 y lleva m√°s de 160 a√±os guiando a los navegantes. Su luz, visible hasta 23 millas n√°uticas, supuso un antes y un despu√©s en la seguridad mar√≠tima de la zona, donde anta√±o apenas se encend√≠an hogueras en la torre vig√≠a. C√≥mo llegar: desde el aparcamiento de la Playa de los Muertos, toma la carretera asfaltada que sube a la cima (bien se√±alizada, con algunas curvas). Curiosidad: en 1934 una nevada cubri√≥ de hielo sus cristales‚Äîuna estampa poco com√∫n aqu√≠.`,
          en: `Perched 220 m above sea level on an ancient volcanic rise, Mesa Rold√°n Lighthouse offers one of the most breathtaking views in Cabo de Gata‚ÄëN√≠jar Natural Park. Just 7 km from Carboneras and 4 km from Agua Amarga, it was inaugurated in 1863 and has guided sailors for over 160 years. Its light, visible up to 23 nautical miles, marked a turning point in local maritime safety, where previously only bonfires blazed from the old watchtower. Getting there: from Playa de los Muertos parking, take the paved road to the summit (well signposted, with a few sharp bends). Fun fact: in 1934, snowfall iced over its windowpanes‚Äîan exceedingly rare sight here.`,
          fr: `Perch√© √† 220 m d‚Äôaltitude au sommet d‚Äôune ancienne formation volcanique, le phare de Mesa Rold√°n offre l‚Äôun des plus beaux panoramas du parc naturel de Cabo de Gata‚ÄëN√≠jar. √Ä 7 km de Carboneras et 4 km d‚ÄôAgua Amarga, il fut inaugur√© en 1863 et guide les marins depuis plus de 160 ans. Sa lumi√®re, visible jusqu‚Äô√† 23 milles nautiques, a transform√© la s√©curit√© maritime locale, l√† o√π l‚Äôon n‚Äôallumait auparavant que des feux de guet. Acc√®s‚ÄØ: depuis le parking de la plage de los Muertos, empruntez la route asphalt√©e jusqu‚Äôau sommet (bien indiqu√©e, avec quelques virages). Anecdote‚ÄØ: en 1934, une chute de neige gla√ßa ses vitres‚Äîun spectacle rarissime ici.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/torre.png',
        videoUrl: '',
        lnglat: [-1.90933, 36.941622],
        nombre: {
          es: 'Torre de Mesa Rold√°n',
          en: 'Mesa Rold√°n Tower',
          fr: 'Tour de Mesa Rold√°n'
        },
        description: {
          es: `En un promontorio entre la Punta de los Muertos y la Punta de Media Naranja, junto al faro hom√≥nimo, esta torre vig√≠a domina el horizonte a m√°s de 220 m sobre el mar. Se construy√≥ en 1766 sobre restos de defensas anteriores de origen musulm√°n y nazar√≠. Su peculiar silueta, conocida como ‚Äútorre de pezu√±a‚Äù, la hace √∫nica. Ya en la Edad Media existi√≥ aqu√≠ una atalaya frente a incursiones vikingas y berberiscas. Con la Reconquista, la Corona reforz√≥ estas defensas y Mesa Rold√°n lleg√≥ a ser uno de los puntos m√°s estrat√©gicos (y peligrosos) de la costa almeriense: los guardas percib√≠an un plus por el riesgo. Geol√≥gicamente, es un domo volc√°nico submarino coronado por un arrecife f√≥sil de coral de hace seis millones de a√±os, responsable de su cima plana. Hoy la torre est√° muy deteriorada. Acceso: basta ascender unos metros a pie desde el faro. Curiosidad: Juego de Tronos rod√≥ aqu√≠ escenas gracias a su paisaje dram√°tico y su atm√≥sfera √∫nica.`,
          en: `On a headland between Punta de los Muertos and Punta de Media Naranja, beside the lighthouse, this watchtower commands the horizon over 220 m above the sea. Built in 1766 upon earlier Muslim and Nasrid structures, its unusual ‚Äúhoof-shaped‚Äù plan makes it unique. A lookout already stood here in the Middle Ages against Viking and Berber raids. During the Reconquista the Crown strengthened these defenses, making Mesa Rold√°n one of the most strategic (and perilous) points along the Almer√≠an coast; guards received hazard pay. Geologically, it‚Äôs an ancient submarine volcanic dome topped by a six‚Äëmillion‚Äëyear‚Äëold fossil coral reef, giving it a flat summit. The tower today is heavily deteriorated. Access: walk a few meters uphill from the lighthouse. Fun fact: Game of Thrones filmed scenes here for its dramatic landscape and atmosphere.`,
          fr: `Sur un promontoire entre Punta de los Muertos et Punta de Media Naranja, √† c√¥t√© du phare, cette tour de guet domine l‚Äôhorizon √† plus de 220 m d‚Äôaltitude. Construite en 1766 sur des vestiges d‚Äôorigine musulmane et nasride, sa forme singuli√®re en ¬´‚ÄØsabot‚ÄØ¬ª la rend unique. Une vigie existait d√©j√† ici au Moyen √Çge pour se pr√©munir des raids vikings et berb√®res. Avec la Reconqu√™te, la Couronne renfor√ßa ces d√©fenses et Mesa Rold√°n devint l‚Äôun des points les plus strat√©giques (et p√©rilleux) de la c√¥te d‚ÄôAlmer√≠a‚ÄØ; les gardes y percevaient une prime de risque. G√©ologiquement, il s‚Äôagit d‚Äôun d√¥me volcanique sous‚Äëmarin surmont√© d‚Äôun r√©cif corallien fossile vieux de six millions d‚Äôann√©es, √† l‚Äôorigine de son sommet plat. La tour est aujourd‚Äôhui tr√®s d√©t√©rior√©e. Acc√®s‚ÄØ: quelques m√®tres √† pied depuis le phare. Anecdote‚ÄØ: Game of Thrones y a tourn√© des sc√®nes, s√©duite par ce d√©cor spectaculaire.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/playamuertos.png',
        videoUrl: '',
        lnglat: [-1.89872, 36.953514],
        nombre: {
          es: 'Playa de los Muertos',
          en: 'Playa de los Muertos',
          fr: 'Playa de los Muertos'
        },
        description: {
          es: `Considerada entre las playas m√°s bellas de Espa√±a, pertenece a Carboneras y se halla en el Parque Natural Cabo de Gata‚ÄëN√≠jar. Famosa por sus aguas turquesa y su entorno virgen, se encaja entre acantilados y formaciones volc√°nicas que dibujan un paisaje de impacto. C√≥mo llegar: desde Carboneras, toma la carretera hacia Agua Amarga y aparca en el parking habilitado junto al mirador y el punto de informaci√≥n. Desde all√≠, un sendero de unos 20 minutos a pie desciende hasta la playa. ¬øSab√≠as por qu√© se llama ¬´de los Muertos¬ª? El nombre recuerda un temporal de 1869 que atrap√≥ a varios pescadores bajo la Mesa Rold√°n; cinco fallecieron pese al rescate, y con el tiempo otros naufragios afianzaron la toponimia.`,
          en: `Ranked among Spain‚Äôs most beautiful beaches, it belongs to Carboneras and lies within the Cabo de Gata‚ÄëN√≠jar Natural Park. Its crystal‚Äëclear turquoise waters and pristine setting are framed by cliffs and volcanic formations. Getting there: from Carboneras, drive toward Agua Amarga and park near the viewpoint and tourist info point. From there, a 20‚Äëminute footpath leads down to the beach. Why the name ‚Äúof the Dead‚Äù? It recalls a 1869 storm that trapped fishermen beneath Mesa Rold√°n; five perished despite rescue efforts, and later shipwrecks cemented the somber toponym.`,
          fr: `Consid√©r√©e comme l‚Äôune des plus belles plages d‚ÄôEspagne, elle rel√®ve de Carboneras et se situe dans le parc naturel de Cabo de Gata‚ÄëN√≠jar. Eaux turquoise cristallines, cadre vierge, falaises et formations volcaniques composent un d√©cor spectaculaire. Acc√®s‚ÄØ: depuis Carboneras, prenez la route d‚ÄôAgua Amarga et garez‚Äëvous pr√®s du belv√©d√®re et du point d‚Äôinformation. De l√†, un sentier d‚Äôenviron 20 minutes descend jusqu‚Äô√† la plage. Pourquoi ¬´‚ÄØdes Morts‚ÄØ¬ª‚ÄØ? Le nom √©voque une temp√™te de 1869 qui pi√©gea des p√™cheurs sous la Mesa Rold√°n‚ÄØ; cinq p√©rirent malgr√© les secours, et d‚Äôautres naufrages ont fix√© la toponymie.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/calaenmedio.png',
        videoUrl: '',
        lnglat: [-1.946871, 36.932317],
        nombre: {
          es: 'Cala de Enmedio',
          en: 'Cala de Enmedio',
          fr: 'Cala de Enmedio'
        },
        description: {
          es: `Peque√±a y resguardada, destaca por sus aguas transparentes y su paisaje volc√°nico. Su acceso exigente ha preservado intacta su belleza, perfecta para quienes buscan calma y naturaleza en estado puro. Ideal para snorkel en aguas claras y ricas en vida. Las formaciones y acantilados que la rodean son un im√°n para fotograf√≠a y senderismo. C√≥mo llegar: desde Agua Amarga, sigue el sendero costero hacia Cala del Plomo y contin√∫a ~1 km m√°s (‚âà1 h 15 min). Desde Cala del Plomo, un paseo se√±alizado de unos 20 minutos entre rocas volc√°nicas conduce a esta joya escondida.`,
          en: `Tucked away and sheltered, it stands out for glass‚Äëclear waters and a volcanic setting. The demanding access has kept it pristine‚Äîa haven for quiet and unspoiled nature. Excellent for snorkeling in lively, transparent waters. Surrounding formations and cliffs are a treat for hikers and photographers. Getting there: from Agua Amarga, follow the coastal trail toward Cala del Plomo and continue ~1 km (‚âà1 h 15 min). From Cala del Plomo, a signed 20‚Äëminute walk over volcanic rock leads to this hidden gem.`,
          fr: `Petite et abrit√©e, elle s√©duit par ses eaux limpides et son d√©cor volcanique. L‚Äôacc√®s exigeant a pr√©serv√© sa beaut√© intacte‚Äîhavre id√©al pour qui cherche calme et nature. Parfaite pour le snorkeling en eaux claires et poissonneuses. Ses formations et falaises attirent randonneurs et photographes. Acc√®s‚ÄØ: depuis Agua Amarga, suivez le sentier c√¥tier vers la Cala del Plomo et continuez ~1 km (‚âà1 h 15). Depuis la Cala del Plomo, un itin√©raire balis√© d‚Äôenviron 20 minutes parmi les roches volcaniques m√®ne √† ce joyau cach√©.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/calasanpedro.png',
        videoUrl: '',
        lnglat: [-1.979374, 36.900086],
        nombre: {
          es: 'Cala de San Pedro',
          en: 'Cala de San Pedro',
          fr: 'Cala de San Pedro'
        },
        description: {
          es: `Un rinc√≥n casi secreto del Parque Natural, famoso por su car√°cter salvaje. Aguas cristalinas, arena clara y fondo rocoso, junto a la antigua Torre de San Pedro (s. XVI), levantada para vigilar la costa ante piratas. Sin carreteras ni urbanizaci√≥n, conserva un encanto especial: ideal para desconectar, hacer snorkel y pasar un d√≠a de playa en paz. C√≥mo llegar: desde Las Negras, sendero costero de ~4 km (‚âà1 h), con algunas pendientes; lleva calzado adecuado y agua. ¬øSab√≠as que‚Ä¶? Desde los a√±os 80 vive aqu√≠ una peque√±a comunidad autosuficiente, sin red de agua ni electricidad, abastecida por un manantial y un estilo de vida sencillo.`,
          en: `A near‚Äësecret nook of the Natural Park, famed for its wild feel. Crystal waters, pale sand and a rocky seabed lie beside the 16th‚Äëcentury San Pedro Tower, raised to guard the coast from pirates. With no roads or urban sprawl, it keeps a singular charm‚Äîperfect to unplug, snorkel and while away a peaceful beach day. Getting there: from Las Negras, a coastal trail of ~4 km (‚âà1 h) with some climbs; bring good shoes and water. Did you know? Since the 1980s, a small self‚Äësufficient community lives here, off‚Äëgrid and supplied by a spring.`,
          fr: `Un recoin presque secret du parc, r√©put√© pour sa sauvagerie. Eaux cristallines, sable clair et fond rocheux, aux c√¥t√©s de l‚Äôancienne tour de San Pedro (XVI·µâ s.), √©rig√©e pour prot√©ger la c√¥te des pirates. Sans routes ni urbanisation, la crique conserve un charme unique‚ÄØ: id√©ale pour d√©connecter, faire du snorkeling et profiter d‚Äôune journ√©e paisible. Acc√®s‚ÄØ: depuis Las Negras, sentier c√¥tier d‚Äôenviron 4 km (‚âà1 h) avec quelques pentes‚ÄØ; emportez de l‚Äôeau et de bonnes chaussures. Le saviez‚Äëvous‚ÄØ? Depuis les ann√©es 1980, une petite communaut√© autosuffisante vit ici, hors r√©seau et aliment√©e par une source.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/industrial.png',
        videoUrl: '',
        lnglat: [-1.907877, 36.976458],
        nombre: {
          es: 'Zona industrial de Carboneras',
          en: 'Carboneras Industrial Area',
          fr: 'Zone industrielle de Carboneras'
        },
        description: {
          es: `Tras la playa de Las Martinicas se abre la zona industrial de Carboneras, que concentra en poco espacio una notable diversidad de actividades. El contraste con los paisajes que aguardan en el Parque Natural Cabo de Gata‚ÄëN√≠jar no puede ser mayor. Entre las industrias destaca la antigua central t√©rmica de Endesa, cerrada desde hace a√±os y hoy en desmantelamiento. La planta desaladora de Carboneras, una de las mayores de Europa, dio un respiro a un territorio marcado por la sequ√≠a‚Äîcon algunas de las menores precipitaciones de Europa occidental‚Äîy abastece consumo humano y regad√≠o en el Campo de N√≠jar y los municipios del Levante Almeriense y Bajo Almanzora.`,
          en: `Beyond Las Martinicas Beach lies Carboneras‚Äô industrial zone, packing a wide array of activities into a compact area‚Äîa striking counterpoint to the natural park ahead. Notable here is Endesa‚Äôs former thermal power plant, shut down years ago and now being dismantled. The Carboneras desalination plant‚Äîamong the largest in Europe‚Äîhas eased the burden of drought in this arid region, where rainfall is among the lowest in Western Europe; its water supports both households and irrigation across Campo de N√≠jar and the Levante Almeriense/Bajo Almanzora municipalities.`,
          fr: `Apr√®s la plage de Las Martinicas s‚Äô√©tend la zone industrielle de Carboneras, o√π se concentre une grande diversit√© d‚Äôactivit√©s‚Äîcontraste saisissant avec le parc naturel tout proche. On y remarque l‚Äôancienne centrale thermique d‚ÄôEndesa, ferm√©e depuis des ann√©es et en cours de d√©mant√®lement. L‚Äôusine de dessalement de Carboneras, l‚Äôune des plus vastes d‚ÄôEurope, a soulag√© un territoire marqu√© par la s√©cheresse‚Äîl‚Äôun des moins arros√©s d‚ÄôEurope occidentale‚Äîet approvisionne en eau potable et d‚Äôirrigation le Campo de N√≠jar ainsi que les communes du Levante Almeriense et du Bas Almanzora.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/cargadero.png',
        videoUrl: '',
        lnglat: [-1.929275, 36.939143],
        nombre: {
          es: 'Cargadero de mineral de Agua Amarga',
          en: 'Agua Amarga Mineral Loading Dock',
          fr: 'Quai de chargement de minerai d‚ÄôAgua Amarga'
        },
        description: {
          es: `Los restos del cargadero de mineral evocan un cap√≠tulo reciente de la historia almeriense: su esplendor minero. Para localizar el antiguo muelle, basta buscar el pe√±√≥n en el mar sobre el que se apoyaba. Med√≠a 70 m de longitud y se situaba a 14 m sobre el nivel del mar. Era el extremo de la l√≠nea f√©rrea entre Lucainena de las Torres y Agua Amarga; se eligi√≥ este punto por estar resguardado de los vientos de levante. Por aqu√≠ se embarcaba el hierro de Sierra Alhamilla. El ferrocarril comenz√≥ a operar en 1896 y en 1942, tras a√±os de actividad intermitente, zarp√≥ el √∫ltimo vapor desde el muelle. Agotados los filones, se desmantelaron las instalaciones para llevar el hierro a Almer√≠a y fundirlo.`,
          en: `The remains of the mineral loading dock recall a not‚Äëtoo‚Äëdistant chapter in Almer√≠a‚Äôs past: its mining heyday. To find the old pier, look for the offshore rock that supported it. The structure was 70 m long and stood 14 m above sea level. It marked the terminus of the railway from Lucainena de las Torres to Agua Amarga, chosen here for shelter from easterly winds. Iron from Sierra Alhamilla shipped out from this point. The line began service in 1896, and in 1942‚Äîafter intermittent activity‚Äîthe last steamer sailed from the pier. Once the veins were exhausted, the facilities were dismantled and the metal taken to Almer√≠a for smelting.`,
          fr: `Les vestiges du quai de chargement de minerai √©voquent un chapitre r√©cent de l‚Äôhistoire d‚ÄôAlmer√≠a‚ÄØ: son √¢ge d‚Äôor minier. Pour situer l‚Äôancien appontement, rep√©rez l‚Äô√Ælot rocheux qui le soutenait. Il mesurait 70 m de long et s‚Äô√©levait √† 14 m au‚Äëdessus du niveau de la mer. Terminus de la voie ferr√©e Lucainena de las Torres‚ÄîAgua Amarga, l‚Äôendroit fut choisi car abrit√© des vents d‚Äôest. Le fer de la Sierra Alhamilla partait d‚Äôici. La ligne entra en service en 1896 et, en 1942‚Äîapr√®s une activit√© intermittente‚Äîle dernier vapeur quitta le quai. Les filons √©puis√©s, les installations furent d√©mont√©es et le m√©tal transport√© √† Almer√≠a pour y √™tre fondu.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/aguamarga.png',
        videoUrl: '',
        lnglat: [-1.935512, 36.940243],
        nombre: {
          es: 'Agua Amarga',
          en: 'Agua Amarga',
          fr: 'Agua Amarga'
        },
        description: {
          es: `Dejamos Carboneras y entramos en el t√©rmino de N√≠jar, donde nos recibe la pedan√≠a de Agua Amarga. La pesca, la miner√≠a y hoy el turismo han marcado su identidad. Alineado con la playa se extiende el antiguo barrio pesquero, de casas bajas y encaladas. M√°s all√° aparecen dos calas emblem√°ticas del Parque Natural: Enmedio y del Plomo. En el paisaje destacan los blancos acantilados de calizas arrecifales.`,
          en: `Leaving Carboneras, we enter the municipality of N√≠jar and the hamlet of Agua Amarga. Fishing, mining and now tourism have shaped its identity. Aligned with the beach lies the former fishing quarter, with low, whitewashed houses. Beyond it are two emblematic coves of the Natural Park: Enmedio and del Plomo. The white cliffs of reef limestone stand out in the scenery.`,
          fr: `Nous quittons Carboneras pour entrer √† N√≠jar, accueillis par le hameau d‚ÄôAgua Amarga. La p√™che, l‚Äôactivit√© mini√®re puis le tourisme ont forg√© son identit√©. Le long de la plage s‚Äô√©tend l‚Äôancien quartier des p√™cheurs, aux maisons basses et blanchies √† la chaux. Plus loin, deux criques embl√©matiques du parc naturel‚ÄØ: Enmedio et del Plomo. Les falaises blanches de calcaires r√©cifaux dominent le paysage.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      },
      {
        iconUrl: 'img/marcador2.png',
        imageUrl: 'img/calaplomo.png',
        videoUrl: '',
        lnglat: [-1.954915, 36.922761],
        nombre: {
          es: 'Cala del Plomo',
          en: 'Cala del Plomo',
          fr: 'Cala del Plomo'
        },
        description: {
          es: `A la derecha encontramos la Cala del Plomo. Es de las m√°s concurridas por su acceso relativamente sencillo por tierra. Sus aguas, muy someras, y su arena fina le dan un aspecto cristalino. En el paisaje llaman la atenci√≥n los blancos acantilados que la enmarcan.`,
          en: `On the right lies Cala del Plomo. It‚Äôs busier than most thanks to relatively easy land access. Very shallow waters and fine sand give it a crystalline look. The surrounding white cliffs complete the scene.`,
          fr: `Sur la droite se trouve la Cala del Plomo. Plus fr√©quent√©e que d‚Äôautres en raison d‚Äôun acc√®s terrestre ais√©. Ses eaux peu profondes et son sable fin lui conf√®rent une transparence cristalline. Les falaises blanches environnantes compl√®tent le d√©cor.`
        },
        audioUrl: { es: '', en: '', fr: '' }
      }
    ];

    // Gesti√≥n de marcadores para evitar duplicados al cambiar de idioma
    const markers = [];
    const languageSelector = document.getElementById('language-selector');

    function getPopupHTML(point, lang) {
      const title = point.nombre[lang] || point.nombre.es;
      const desc = point.description[lang] || point.description.es;
      const img = point.imageUrl ? `
        <img class="popup-media" src="${point.imageUrl}" alt="${title}" loading="lazy" />
      ` : '';
      const vid = point.videoUrl ? `
        <video class="popup-media" src="${point.videoUrl}" controls playsinline></video>
      ` : '';
      const audioSrc = point.audioUrl && point.audioUrl[lang] ? point.audioUrl[lang] : '';

      return `
        <h3 class="popup-title">${title}</h3>
        ${img}
        <div class="popup-description">${desc}</div>
        ${vid}
        ${audioSrc ? `<audio src="${audioSrc}" controls></audio>` : ''}
      `;
    }

    function createMarker(point, lang) {
      const el = document.createElement('div');
      el.className = 'marker';
      el.style.backgroundImage = `url(${point.iconUrl})`;
      el.tabIndex = 0;
      el.setAttribute('role', 'button');
      el.setAttribute('aria-label', point.nombre[lang] || point.nombre.es);

      const popup = new mapboxgl.Popup({ offset: 28 })
        .setHTML(getPopupHTML(point, lang));

      popup.on('open', () => {
        const el = popup.getElement();
        const box = el ? el.querySelector('.popup-description') : null;
        if (box) box.scrollTop = 0;
      });

      const marker = new mapboxgl.Marker({ element: el, anchor: 'bottom' })
        .setLngLat(point.lnglat)
        .setPopup(popup)
        .addTo(map);

      return { marker, popup, el, point };
    }

    function initMarkers(lang = 'es') {
      Puntos.forEach(p => markers.push(createMarker(p, lang)));
    }

    function updateLanguage(lang) {
      markers.forEach(m => {
        m.popup.setHTML(getPopupHTML(m.point, lang));
        m.el.setAttribute('aria-label', m.point.nombre[lang] || m.point.nombre.es);
      });
    }

    languageSelector.addEventListener('change', (e) => {
      const lang = e.target.value;
      updateLanguage(lang);
      showToast(
        lang === 'es' ? 'Idioma: Espa√±ol' :
        lang === 'en' ? 'Language: English' : 'Langue : Fran√ßais',
        1800
      );
    });

    // Render inicial
    initMarkers('es');
  </script>
</body>